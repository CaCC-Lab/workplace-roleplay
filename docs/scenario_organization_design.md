# 職場コミュニケーション練習アプリ - シナリオ分離設計書

## 1. システム概要

### 現状の課題
- 44シナリオが全て混在している状態
  - scenario1-33: 通常のコミュニケーション練習 (33個)
  - scenario34-43 + harassment_gray_zones: ハラスメント防止研修 (11個)
- ハラスメント関連シナリオに対する適切な警告・配慮が不足

### 目標
- ホームページを2つの明確なセクションに分離
- ハラスメント防止シナリオに対する適切な警告・同意フロー
- プロフェッショナルで配慮のあるUX/UI設計

## 2. システム設計

### 2.1 全体アーキテクチャ

```
ホームページ
├── 職場のコミュニケーションシナリオ（Regular Communication）
│   ├── 33個の通常シナリオ
│   ├── 即座にアクセス可能
│   └── 軽い雰囲気のUI
│
└── 職場のハラスメント対策シナリオ（Harassment Prevention）
    ├── 警告・同意画面
    ├── 11個のハラスメント関連シナリオ
    └── 配慮のあるプロフェッショナルなUI
```

### 2.2. アーキテクチャ変更点

#### 2.2.1. バックエンド (Flask)

- **シナリオ分類ロジックの追加**:
    - `app.py` または `scenarios/category_manager.py` に、シナリオを分類するロジックを実装する。
    - **分類基準**:
        - **ハラスメント対策シナリオ**: `scenarios/data/` 内の `scenario34.yaml` から `scenario43.yaml` まで、および `harassment_gray_zones.yaml`。
        - **一般コミュニケーションシナリオ**: 上記以外のすべての `scenario*.yaml` ファイル。
- **APIエンドポイントの変更**:
    - 現在シナリオリストを返しているエンドポイント（例: `/api/scenarios`）を修正、もしくは新しいエンドポイント（例: `/api/categorized_scenarios`）を作成する。
    - レスポンス形式を、カテゴリ分けされたJSON構造に変更する。
      ```json
      {
        "general_communication": [
          { "id": "scenario1", "title": "...", "summary": "..." },
          ...
        ],
        "harassment_prevention": [
          { "id": "scenario34", "title": "...", "summary": "..." },
          ...
        ]
      }
      ```

#### 2.2.2. フロントエンド (HTML/JavaScript)

- **ホームページ (`templates/index.html`) の構造変更**:
    - ページを2つの主要セクションに分割する。
        - `<section id="general-scenarios">`
            - `<h2>職場のコミュニケーションシナリオ</h2>`
            - 一般シナリオへのリンクを配置するカード型UI
        - `<section id="harassment-scenarios">`
            - `<h2>職場のハラスメント対策シナリオ</h2>`
            - ハラスメント対策シナリオへのリンクを配置するカード型UI
- **警告・同意モーダルの実装**:
    - ハラスメント対策セクションのリンクをクリックした際に表示されるモーダルウィンドウを実装する。
    - モーダルには、内容のデリケートさに関する警告文、学習の目的、および「同意して進む」「キャンセル」のボタンを配置する。
    - 同意状態は `sessionStorage` を利用して管理し、ユーザーがブラウザセッション中に再度モーダルに遭遇することを防ぐ。

## 3. ユーザーフロー

### 3.1. 一般コミュニケーションシナリオの選択

1.  ユーザーはホームページにアクセスする。
2.  「職場のコミュニケーションシナリオ」セクションが表示される。
3.  ユーザーは興味のあるシナリオをクリックする。
4.  直接、該当のシナリオ練習ページ (`/scenario/<scenario_id>`) に遷移する。

### 3.2. ハラスメント対策シナリオの選択

1.  ユーザーはホームページにアクセスする。
2.  「職場のハラスメント対策シナリオ」セクションが表示される。
3.  ユーザーは興味のあるシナリオをクリックする。
4.  **警告・同意モーダルが表示される。**
    - **モーダルの内容例**:
        > **ハラスメント対策シナリオについて**
        >
        > このセクションには、職場のハラスメントに関連するデリケートな内容が含まれる可能性があります。
        >
        > これらのシナリオは、ハラスメントへの適切な対応方法を学び、健全な職場環境を築くことを目的としています。ご自身の判断で学習を進めてください。
        >
        > **学習を続けますか？**
        >
        > `[同意して進む]` `[キャンセル]`
5.  ユーザーが「同意して進む」をクリックする。
    - モーダルが閉じ、該当のシナリオ練習ページ (`/scenario/<scenario_id>`) に遷移する。
6.  ユーザーが「キャンセル」をクリック、またはモーダルを閉じる。
    - モーダルが閉じ、ホームページに留まる。

## 4. 実装方針

1.  **バックエンド開発**:
    - `app.py` のシナリオ読み込み部分を修正し、上記の分類基準に基づいて2つのリスト（一般、ハラスメント）を生成する関数を作成する。
    - シナリオリストを返すAPIエンドポイントを修正し、2.2.1で定義したJSON形式でデータを返すように変更する。

2.  **フロントエンド開発**:
    - `templates/index.html` (またはシナリオ一覧に相当するテンプレート) のHTML構造を、2つの `<section>` を持つレイアウトに変更する。
    - `static/js/` 内の関連JavaScriptファイルを修正する。
        - ページ読み込み時にAPIからカテゴリ分類されたシナリオデータを取得する。
        - 取得したデータを用いて、2つのセクションにシナリオのカードを動的に描画する。
    - 警告・同意モーダルのHTML、CSS、JavaScriptを実装する。
        - ハラスメントシナリオのカードがクリックされた際のイベントリスナーを追加する。
        - イベント発火時にモーダルを表示し、ユーザーの選択に応じてページ遷移またはモーダルを閉じる処理を実装する。
        - 同意後は `sessionStorage.setItem('consent_given', 'true')` のようにフラグを立て、以降のクリックではモーダルを再表示しないように制御する。

## 5. セキュリティと倫理的配慮

- **同意の記録**:
    - ユーザーの同意は、プライバシーを尊重し、サーバーサイドのデータベースには記録しない。クライアントサイドの `sessionStorage` での管理に留める。これにより、ユーザーがセッションを終了すれば同意状態はリセットされる。
- **コンテンツの配慮**:
    - 警告文は、ユーザーを不必要に不安にさせるものではなく、学習目的を明確に伝え、あくまで自己決定を促すためのものであることを強調する。
- **離脱の容易さ**:
    - ユーザーはいつでもシナリオから離脱し、ホームページに戻ることができるように、明確なナビゲーションを維持する。
- **アクセス制御**:
    - 現状の要件では不要だが、将来的に企業研修などで利用する場合、特定のユーザーグループのみにハラスメントシナリオへのアクセスを許可するような拡張も考慮できる設計とする。ただし、本改修のスコープ外とする。
