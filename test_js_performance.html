<!DOCTYPE html>
<html>
<head>
    <title>JavaScript Performance Test</title>
</head>
<body>
    <h1>シナリオ一覧JavaScript パフォーマンステスト</h1>
    <div id="results"></div>
    
    <script>
        const resultsDiv = document.getElementById('results');
        
        function log(message) {
            const p = document.createElement('p');
            p.textContent = message;
            resultsDiv.appendChild(p);
            console.log(message);
        }
        
        async function testScenarioPage() {
            log('テスト開始...');
            
            try {
                // ページを取得
                const start = performance.now();
                const response = await fetch('http://localhost:5001/scenarios');
                const html = await response.text();
                const fetchTime = performance.now() - start;
                log(`ページ取得時間: ${fetchTime.toFixed(2)}ms`);
                
                // HTMLをパース
                const parseStart = performance.now();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const parseTime = performance.now() - parseStart;
                log(`HTMLパース時間: ${parseTime.toFixed(2)}ms`);
                
                // シナリオカードを確認
                const cards = doc.querySelectorAll('.scenario-card');
                log(`シナリオカード数: ${cards.length}`);
                
                // JavaScriptの実行をシミュレート
                const jsStart = performance.now();
                
                // ソート処理をシミュレート
                const sortableCards = Array.from(cards);
                sortableCards.sort((a, b) => {
                    const hrefA = a.querySelector('.primary-button')?.getAttribute('href') || '';
                    const hrefB = b.querySelector('.primary-button')?.getAttribute('href') || '';
                    const idA = parseInt(hrefA.match(/scenario(\d+)/)?.[1] || '0');
                    const idB = parseInt(hrefB.match(/scenario(\d+)/)?.[1] || '0');
                    return idA - idB;
                });
                
                const jsTime = performance.now() - jsStart;
                log(`ソート処理時間: ${jsTime.toFixed(2)}ms`);
                
                // DOM操作をシミュレート
                const domStart = performance.now();
                const container = document.createElement('div');
                sortableCards.forEach(card => {
                    container.appendChild(card.cloneNode(true));
                });
                const domTime = performance.now() - domStart;
                log(`DOM操作時間: ${domTime.toFixed(2)}ms`);
                
                const totalTime = fetchTime + parseTime + jsTime + domTime;
                log(`合計時間: ${totalTime.toFixed(2)}ms`);
                
            } catch (error) {
                log(`エラー: ${error.message}`);
            }
        }
        
        // テストを実行
        testScenarioPage();
    </script>
</body>
</html>