# TODO.md - 開発実装計画

このファイルは、要件定義書に基づいて今後実装すべき機能をまとめたものです。
優先度：高（必須）、中（重要）、低（あれば良い）で分類しています。

## 📌 フェーズ1: 基盤機能（優先度：高）

### 1.1 セキュリティ・認証基盤
- [ ] **ユーザー認証システムの実装**
  - [ ] ユーザー登録・ログイン機能
  - [ ] セッション管理の強化（現在は単純なFlask-Session）
  - [ ] パスワードハッシュ化（bcrypt等）
  - [ ] JWT認証の実装（APIセキュリティ向上）

- [ ] **データセキュリティの強化**
  - [ ] HTTPS対応（SSL証明書の設定）
  - [ ] 会話データの暗号化保存
  - [ ] SQLインジェクション対策
  - [ ] XSS/CSRF対策の実装

### 1.2 データベース統合
- [ ] **SQLiteまたはPostgreSQLの導入**
  - [ ] ユーザーテーブル設計
  - [ ] 会話履歴テーブル設計
  - [ ] 学習進捗テーブル設計
  - [ ] マイグレーションスクリプト作成

### 1.3 会話メモリの永続化
- [ ] **ユーザー別会話履歴の保存**
  - [ ] DBへの会話履歴保存機能
  - [ ] 会話履歴の検索・フィルタリング
  - [ ] 会話のエクスポート機能（CSV/JSON）

## 📌 フェーズ2: コア機能強化（優先度：高〜中）

### 2.1 ロールプレイモード強化
- [ ] **リアルタイムフィードバック機能**
  - [ ] 会話中の即時アドバイス表示
  - [ ] 複数の回答案の提示
  - [ ] 「より良い表現」の提案機能

- [x] **長所・ポジティブフィードバックの強化**（2025年6月10日実装）
  - [x] ユーザーの強み分析機能
    - [x] 6つのコミュニケーションスキル項目の定義（共感力、明確な伝達力、傾聴力、適応力、前向きさ、プロフェッショナリズム）
    - [x] 会話履歴からのスキル分析
    - [x] トップ3の強み表示
  - [x] 成長グラフの表示
    - [x] レーダーチャートによる現在のスキル可視化
    - [x] 時系列グラフによる成長推移表示
    - [x] Chart.jsライブラリの統合
  - [x] 励ましメッセージの自動生成
    - [x] 成長パターンに基づくメッセージ生成
    - [x] パーソナライズされた励ましの追加
    - [x] 継続的な練習を促すメカニズム

- [ ] **職場のあなた再現シート統合**
  - [ ] シート入力フォームの作成
  - [ ] シート情報に基づくパーソナライズ
  - [ ] カスタムシナリオ生成機能

### 2.2 雑談・観戦モード強化
- [ ] **ユーザー介入機能（3者会話）**
  - [ ] 観戦中の「参加」ボタン実装
  - [ ] 3者会話のUIデザイン
  - [ ] 発言順序の管理ロジック

- [ ] **テーマプリセットの拡充**
  - [ ] カテゴリ別テーマ管理
  - [ ] ユーザー投稿テーマ機能
  - [ ] 人気テーマランキング

- [ ] **会話まとめ・要約機能**
  - [ ] 会話終了時の自動要約生成
  - [ ] キーポイントの抽出
  - [ ] 学習ポイントのハイライト

### 2.3 コンテンツモデレーション
- [ ] **不適切発言のフィルタリング**
  - [ ] NGワードリストの管理
  - [ ] AI発言の事前チェック
  - [ ] ユーザー通報機能

- [ ] **会話品質管理**
  - [ ] ループ検出（同じ話題の繰り返し）
  - [ ] 脱線防止メカニズム
  - [ ] 会話長さの自動調整

## 📌 フェーズ3: UI/UX改善（優先度：中）

### 3.1 ユーザビリティ向上
- [ ] **ダークモード対応**
  - [ ] テーマ切り替え機能
  - [ ] ユーザー設定の保存
  - [ ] システム設定との連動

- [ ] **レスポンシブデザイン改善**
  - [ ] モバイル対応の強化
  - [ ] タブレット最適化
  - [ ] タッチ操作の改善

- [ ] **アクセシビリティ向上**
  - [ ] フォントサイズ調整機能
  - [ ] 読み上げ機能対応
  - [ ] キーボードナビゲーション

### 3.2 チュートリアル・ヘルプ
- [ ] **初回利用者向けガイド**
  - [ ] インタラクティブチュートリアル
  - [ ] ツールチップの追加
  - [ ] FAQ・ヘルプページ

- [ ] **操作説明動画**
  - [ ] 各モードの使い方動画
  - [ ] ベストプラクティス紹介
  - [ ] トラブルシューティング

## 📌 フェーズ4: 高度な機能（優先度：中〜低）

### 4.1 グループ・セミナー機能
- [ ] **複数ユーザー同時利用**
  - [ ] ルーム作成・参加機能
  - [ ] 画面共有機能
  - [ ] インストラクターモード

- [ ] **グループフィードバック**
  - [ ] 参加者間の相互評価
  - [ ] グループ討議機能
  - [ ] 成果共有機能

### 4.2 分析・レポート機能
- [ ] **学習分析ダッシュボード**
  - [ ] 練習時間の統計
  - [ ] スキル向上の可視化
  - [ ] 弱点分析レポート

- [ ] **定期レポート生成**
  - [ ] 週次/月次レポート
  - [ ] PDF出力機能
  - [ ] メール配信機能

### 4.3 エクスポート・連携機能
- [ ] **データエクスポート**
  - [ ] 会話履歴のPDF出力
  - [ ] Markdown形式出力
  - [ ] 学習記録のCSV出力

- [ ] **外部サービス連携**
  - [ ] カレンダー連携（練習予定）
  - [ ] Slack/Teams通知
  - [ ] 学習管理システム（LMS）連携

## 📌 フェーズ5: 将来的な拡張（優先度：低）

### 5.1 音声機能
- [ ] **音声入力対応**
  - [ ] 音声認識（STT）統合
  - [ ] リアルタイム文字起こし
  - [ ] 音声コマンド対応

- [x] **音声出力対応**
  - [x] テキスト読み上げ（TTS）- Gemini TTS APIで実装済み（2025年6月6日）
    - [x] 参考プロジェクトからの実装移植完了
    - [x] 複数の音声タイプ（男性・女性・中性）のサポート
    - [x] WAV形式での高品質音声出力（24kHz、16ビット、モノラル）
    - [x] Web Speech APIによるフォールバック機能
    - [x] シナリオごとの固定音声設定（2025年6月9日）
      - [x] 役職・年齢・性別に応じた30種類の音声マッピング
      - [x] ロールプレイ中の音声一貫性を確保
      - [x] 雑談練習モードでのTTS対応
    - [x] **音声事前生成機能**（2025年6月10日）
      - [x] AI応答と同時に音声データを生成
      - [x] 生成済み音声のキャッシュ機能
      - [x] ボタンクリック時の即座再生
      - [x] メモリ管理（50個超で自動クリーンアップ）
      - [x] 視覚的フィードバック（準備完了インジケーター）
  - [x] 感情を込めた音声生成（音声スタイルの制御）- 部分的に実装済み
    - [x] 感情検出機能の実装
    - [x] プロンプトによる感情表現（同一音声で異なる感情を表現）
  - [ ] 多言語音声対応（現在は日本語のみ）

### 5.2 ビジュアル機能（新規提案：2025年6月9日）
- [x] **AIキャラクター画像生成**（部分的に実装済み - 2025年6月10日）
  - [x] Gemini Image Generation API (gemini-2.0-flash-preview-image-generation) の統合
  - [x] セリフに合わせた相手役の表情画像生成
  - [x] シナリオのキャラクター設定に基づいた詳細なプロンプト作成
  - [x] 感情検出結果を表情に反映（喜び、悲しみ、怒り、困惑など）
  - [x] 職場環境を背景とした画像生成
  - [x] 生成画像のキャッシュ機能（同じ感情・キャラクターの再利用）
  - [ ] **キャラクターの一貫性問題の解決**（現在無効化中）
    - [ ] 同一キャラクターの外見統一性の確保
    - [ ] より高度なプロンプトエンジニアリング
    - [ ] 代替アプローチの検討（事前生成画像セット等）
  
- [x] **画像表示機能の実装**（実装済み - 2025年6月10日）
  - [x] 会話画面への画像表示エリアの追加
  - [x] 画像の適切なサイズ調整とレイアウト
  - [x] 画像生成中のローディング表示
  - [x] 画像生成エラー時のフォールバック（デフォルト画像）
  
- [x] **画像生成プロンプトの最適化**（実装済み - 2025年6月10日）
  - [x] キャラクター設定（年齢、性別、役職）の視覚化
  - [x] 日本のビジネスシーンに適した服装・外見
  - [x] 表情と感情の対応マッピング
  - [x] シナリオごとの背景設定（会議室、オフィス、休憩室など）

### 5.3 ゲーミフィケーション
- [ ] **ポイント・バッジシステム**
  - [ ] 練習ポイントの付与
  - [ ] 実績バッジの獲得
  - [ ] レベルアップシステム

- [ ] **ランキング・競争要素**
  - [ ] 週間/月間ランキング
  - [ ] フレンド機能
  - [ ] チャレンジモード

### 5.4 AI機能の高度化
- [ ] **表情・感情分析**
  - [ ] Webカメラ統合
  - [ ] 表情認識
  - [ ] 感情フィードバック

- [ ] **マルチモーダル対応**
  - [ ] 画像を使った会話
  - [ ] ジェスチャー認識
  - [ ] VR/AR対応

## 🔧 技術的改善

### インフラ・運用
- [ ] **Docker化**
  - [ ] Dockerfileの作成
  - [ ] docker-compose設定
  - [ ] 開発環境の統一

- [ ] **CI/CD パイプライン**
  - [ ] GitHub Actions設定
  - [ ] 自動テスト実行
  - [ ] 自動デプロイ

- [ ] **監視・ログ管理**
  - [ ] エラー監視（Sentry等）
  - [ ] パフォーマンス監視
  - [ ] ログ集約・分析

### コード品質
- [ ] **テストカバレッジ向上**
  - [ ] ユニットテスト作成
  - [ ] 統合テスト作成
  - [ ] E2Eテスト実装

- [ ] **リファクタリング**
  - [ ] コードの構造化改善
  - [ ] 型ヒントの完全化
  - [ ] ドキュメント整備

## 📅 実装スケジュール案

### 短期（1-2ヶ月）
- フェーズ1の完了（セキュリティ基盤）
- フェーズ2.1の開始（ロールプレイ強化）

### 中期（3-6ヶ月）
- フェーズ2の完了
- フェーズ3の実装
- フェーズ4の一部着手

### 長期（6ヶ月以降）
- フェーズ4の完了
- フェーズ5の検討・部分実装
- 継続的な改善とメンテナンス

## 💡 注意事項

1. **優先順位の見直し**
   - ユーザーフィードバックに基づいて優先順位を定期的に見直す
   - 技術的な依存関係を考慮して実装順序を調整

2. **段階的リリース**
   - 機能ごとにフィーチャーフラグを使用
   - A/Bテストによる効果測定
   - 段階的なロールアウト

3. **パフォーマンス考慮**
   - 各機能実装時にパフォーマンステストを実施
   - スケーラビリティを考慮した設計

---

最終更新日: 2025年6月11日

## 📝 実装履歴

### 2025年6月11日
- **音声生成機能の改善とバグ修正**
  - 音声再生ボタンの停止機能修正
  - 統一TTS機能（tts-common.js）への完全移行
  - 音声生成の一貫性問題の解決
  - キャッシュ管理の改善
  - Web Speech APIフォールバック機能の統一

### 2025年6月10日
- **長所・ポジティブフィードバックの強化機能を実装**
  - 強み分析機能（strength_analyzer.py）
  - 強み分析ページ（/strength_analysis）
  - レーダーチャートと成長推移グラフ
  - 既存のフィードバック機能への統合
  - ホームページへの強み分析カードの追加